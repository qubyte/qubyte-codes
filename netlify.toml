[build]
  publish = "public"
  command = "npm run build"

[build.processing]
  skip_processing = true

[build.processing.html]
  pretty_urls = true

[build.environment]
  NODE_ENV = "production"
  BASE_TITLE = "Qubyte Codes"

[functions]
  directory = "functions"
  node_bundler = "esbuild"
  external_node_modules = ["jsdom"]

[[edge_functions]]
  cache = "manual"
  path = "/*"
  excludedPattern = "^(.*)\.(json|xml|opml|css|js|pdf|svg|png|avif|webp|jpeg|jpg|txt)$"
  function = "add-html-security-headers"

[[context.production.plugins]]
  package = "/plugins/dispatch-webmentions"

[[context.production.plugins]]
  package = "/plugins/toot-new-blog-posts"

[[context.production.plugins]]
  package = "/plugins/update-shortlinks"

[[headers]]
  for = "/japanese-notes*"
  [headers.values]
    X-Robots-Tag = "none"

[[headers]]
  for = "/hashed-*"
  [headers.values]
    Cache-Control = "max-age=315360000, public, immutable"

[[headers]]
  for = "/scripts/hashed-*"
  [headers.values]
    Cache-Control = "max-age=315360000, public, immutable"

[[headers]]
  for = "*.css"
  [headers.values]
    Cache-Control = "max-age=315360000, public, immutable"

[[headers]]
  for = "*atom.xml"
  [headers.values]
    Content-Type = "application/atom+xml; charset=utf-8"

[[headers]]
  for = "/feeds.opml"
  [headers.values]
    Content-Type = "application/xml; charset=utf-8"

[[headers]]
  for = "/sw.js"
  [headers.values]
    Content-Security-Policy = "connect-src *;"

[[redirects]]
  from = "/s/gh"
  to = "https://github.com/qubyte/"

[[redirects]]
  from = "/s/tw"
  to = "https://twitter.com/qubyte"

[[redirects]]
  from = "/s/npm"
  to = "https://www.npmjs.com/~qubyte"

[[redirects]]
  from = "/s/pw"
  to = "https://www.polywork.com/qubyte"

[[redirects]]
  from = "/s/ln"
  to = "https://www.linkedin.com/in/markseveritt/"
